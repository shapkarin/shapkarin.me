<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link href="/favicon/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png"><link href="/favicon/favicon.svg" rel="icon" type="image/svg+xml"><link href="/favicon/favicon.ico" rel="shortcut icon"><link href="/favicon/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"><meta content="shapkarin.me" name="apple-mobile-web-app-title"><link href="/favicon/site.webmanifest" rel="manifest"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="#000000" name="theme-color"><title>Drop React Manual Memoization | The Mutability & Aliasing Model in React | Iurii Shapkarin</title><meta content="Iurii Shapkarin's personal website" name="description"><meta content="website" property="og:type"><meta content="Iurii Shapkarin | Software Developer" property="og:title"><meta content="Iurii Shapkarin's personal website" property="og:description"><meta content="https://shapkarin.me" property="og:url"><meta content="Iurii Shapkarin" name="twitter:creator"><meta content="website" name="twitter:card"><meta content="Iurii Shapkarin | Software Developer" name="twitter:title"><meta content="Iurii Shapkarin's personal website" name="twitter:description"><link href="https://fonts.googleapis.com/css?family=Lato:300" rel="stylesheet"><title>Iurii Shapkarin</title><link href="https://fonts.googleapis.com" rel="preconnect"><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin=""><link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet"><script defer src="/static/js/main.c473683a.js"></script><link href="/static/css/main.ded8ac45.css" rel="stylesheet"><link href="https://fonts.googleapis.com" rel="preconnect"><link href="https://fonts.gstatic.com" rel="preconnect"><link href="https://raw.githubusercontent.com" rel="preconnect"><link href="https://shapkarin.me/articles/drop-react-manual-memoization/" rel="canonical" data-react-helmet="true"><meta content="Deep dive into the new mutability & aliasing model powering React Compiler (June 2025) and how it eliminates most manual memoization." name="description" data-react-helmet="true"><meta content="" name="keywords" data-react-helmet="true"><meta content="article" data-react-helmet="true" property="og:type"><meta content="Drop React Manual Memoization | The Mutability & Aliasing Model in React | Iurii Shapkarin" data-react-helmet="true" property="og:title"><meta content="Deep dive into the new mutability & aliasing model powering React Compiler (June 2025) and how it eliminates most manual memoization." data-react-helmet="true" property="og:description"><meta content="https://shapkarin.me/articles/drop-react-manual-memoization/" data-react-helmet="true" property="og:url"><meta content="Iurii Shapkarin" name="twitter:creator" data-react-helmet="true"><meta content="article" name="twitter:card" data-react-helmet="true"><meta content="Drop React Manual Memoization | The Mutability & Aliasing Model in React | Iurii Shapkarin" name="twitter:title" data-react-helmet="true"><meta content="Deep dive into the new mutability & aliasing model powering React Compiler (June 2025) and how it eliminates most manual memoization." name="twitter:description" data-react-helmet="true"><script data-react-helmet="true" type="application/ld+json">[{"@context":"https://schema.org","@type":"CreativeWork","name":"React Compiler Mutability Analysis and Reactive Scopes Flow","image":["https://shapkarin.me/api/articles/drop-react-manual-memoization-0.svg","https://shapkarin.me/api/articles/drop-react-manual-memoization-1.svg"],"description":"Technical diagrams showing React Compiler's mutability and aliasing model analysis process, from places and effects to reactive scopes, and the sequential flow of inference passes that enable automatic memoization.","hasPart":[{"@type":"WebPageElement","name":"Introduction","url":"#introduction"},{"@type":"WebPageElement","name":"Quick Summary","url":"#quick-summary"},{"@type":"WebPageElement","name":"Why does React need a mutation model?","url":"#why-does-react-need-a-mutation-model"},{"@type":"WebPageElement","name":"Building Blocks: Places, Effects & Ranges","url":"#building-blocks-places-effects-ranges"},{"@type":"WebPageElement","name":"Effects Reference","url":"#effects-reference"},{"@type":"WebPageElement","name":"Key Inference Rules (Mental Model)","url":"#key-inference-rules-mental-model"},{"@type":"WebPageElement","name":"Writing Compiler-Friendly Code","url":"#writing-compiler-friendly-code"},{"@type":"WebPageElement","name":"Frequently Asked Questions","url":"#frequently-asked-questions"},{"@type":"WebPageElement","name":"Conclusion","url":"#conclusion"}]},{"@context":"https://schema.org","@type":"ImageObject","name":"React Compiler Analysis Building Blocks Diagram","description":"Hierarchical diagram showing React Compiler's core analysis concepts: Places (variables and properties), Effects (create, mutate, alias, freeze), and Ranges (instruction scopes) leading to reactive scopes and memoization boundaries","contentUrl":"https://shapkarin.me/api/articles/drop-react-manual-memoization-0.svg","encodingFormat":"image/svg+xml","learningResourceType":"diagram","educationalUse":["learning","presentation"],"about":{"@type":"Thing","name":"React Compiler Mutability Analysis"}},{"@context":"https://schema.org","@type":"ImageObject","name":"React Compiler Inference Passes Flow Diagram","description":"Sequential flowchart showing the three-stage process of React Compiler's mutability analysis: InferMutationAliasingEffects, InferMutationAliasingRanges, and InferReactiveScopeVariables leading to memoization blocks","contentUrl":"https://shapkarin.me/api/articles/drop-react-manual-memoization-1.svg","encodingFormat":"image/svg+xml","learningResourceType":"diagram","educationalUse":["learning","presentation"],"about":{"@type":"Thing","name":"React Compiler Processing Pipeline"}}]</script></head><body><div id="root"><a href="#menu" class="a11y hidden">Go to Menu</a><div class="About"><a href="/" class="About_greeting">Hello everyone!</a> My name is Iurii Shapkarin. I am a software engineer with over a decade of experience and a solid foundation in Computer Science. My work reflects a firm commitment to innovation, problem-solving, and delivering exceptional user experiences.<a href="https://www.linkedin.com/in/shapkarin" target="_blank" rel="noreferrer" class="Social_Link">LinkedIn<svg fill="none" height="1em" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg></a><a href="https://github.com/shapkarin" target="_blank" rel="noreferrer" class="Social_Link">GitHub<svg fill="none" height="1em" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg></a><span class="About_email">Get my email</span><em class="Disclaimer">Disclaimer: homepage has been gradually developed <a href="https://web.archive.org/web/20130801000000*/shapkarin.me" target="_blank" rel="noreferrer">since 2013<svg fill="none" height="1em" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg></a>with limited time | <a href="https://github.com/shapkarin/shapkarin.me" target="_blank" rel="noreferrer">cource code<svg fill="none" height="1em" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg></a></em></div><nav aria-label="Main Menu" class="Menu" id="menu" role="navigation"><ul class="Menu_List"><li class="Menu_List_Item"><a href="/" class="Menu__Item"><svg fill="currentColor" height="1em" stroke="currentColor" stroke-width="0" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M20 22H4C3.44772 22 3 21.5523 3 21V3C3 2.44772 3.44772 2 4 2H20C20.5523 2 21 2.44772 21 3V21C21 21.5523 20.5523 22 20 22ZM19 20V4H5V20H19ZM7 6H11V10H7V6ZM7 12H17V14H7V12ZM7 16H17V18H7V16ZM13 7H17V9H13V7Z"></path></svg> Articles</a></li><li class="Menu_List_Item"><a href="/github/repositories/" class="Menu__Item"><svg fill="currentColor" height="1em" stroke="currentColor" stroke-width="0" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3 2.75A2.75 2.75 0 0 1 5.75 0h14.5a.75.75 0 0 1 .75.75v20.5a.75.75 0 0 1-.75.75h-6a.75.75 0 0 1 0-1.5h5.25v-4H6A1.5 1.5 0 0 0 4.5 18v.75c0 .716.43 1.334 1.05 1.605a.75.75 0 0 1-.6 1.374A3.251 3.251 0 0 1 3 18.75ZM19.5 1.5H5.75c-.69 0-1.25.56-1.25 1.25v12.651A2.989 2.989 0 0 1 6 15h13.5Z"></path><path d="M7 18.25a.25.25 0 0 1 .25-.25h5a.25.25 0 0 1 .25.25v5.01a.25.25 0 0 1-.397.201l-2.206-1.604a.25.25 0 0 0-.294 0L7.397 23.46a.25.25 0 0 1-.397-.2v-5.01Z"></path></svg> Repositories</a></li><li class="Menu_List_Item"><a href="/github/likes/" class="Menu__Item"><svg fill="currentColor" height="1.2em" stroke="currentColor" stroke-width="0" viewBox="0 0 24 24" width="1.2em" xmlns="http://www.w3.org/2000/svg"><path d="M12 .25a.75.75 0 0 1 .673.418l3.058 6.197 6.839.994a.75.75 0 0 1 .415 1.279l-4.948 4.823 1.168 6.811a.751.751 0 0 1-1.088.791L12 18.347l-6.117 3.216a.75.75 0 0 1-1.088-.79l1.168-6.812-4.948-4.823a.75.75 0 0 1 .416-1.28l6.838-.993L11.328.668A.75.75 0 0 1 12 .25Zm0 2.445L9.44 7.882a.75.75 0 0 1-.565.41l-5.725.832 4.143 4.038a.748.748 0 0 1 .215.664l-.978 5.702 5.121-2.692a.75.75 0 0 1 .698 0l5.12 2.692-.977-5.702a.748.748 0 0 1 .215-.664l4.143-4.038-5.725-.831a.75.75 0 0 1-.565-.41L12 2.694Z"></path></svg> Likes</a></li><li class="Menu_List_Item"><a href="/packages/" class="Menu__Item"><svg fill="currentColor" height="1.24em" stroke="currentColor" stroke-width="0" viewBox="0 0 24 24" width="1.24em" xmlns="http://www.w3.org/2000/svg"><path d="M20.001 3C20.5533 3 21.001 3.44772 21.001 4V20C21.001 20.5523 20.5533 21 20.001 21H4.00098C3.44869 21 3.00098 20.5523 3.00098 20V4C3.00098 3.44772 3.44869 3 4.00098 3H20.001ZM19.001 5H5.00098V19H19.001V5ZM17.001 7V17H14.501V9.5H12.001V17H7.00098V7H17.001Z"></path></svg> Packages</a></li><li class="Menu_List_Item"><a href="/creative/" class="Menu__Item"><svg fill="currentColor" height="1em" stroke="currentColor" stroke-width="0" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4 2.99658H20C20.5523 2.99658 21 3.4443 21 3.99658V8.99658C21 9.54887 20.5523 9.99658 20 9.99658H4C3.44772 9.99658 3 9.54887 3 8.99658V3.99658C3 3.4443 3.44772 2.99658 4 2.99658ZM6 11.9966H12C12.5523 11.9966 13 12.4443 13 12.9966V15.9966H14V21.9966H10V15.9966H11V13.9966H5C4.44772 13.9966 4 13.5489 4 12.9966V10.9966H6V11.9966ZM17.7322 13.7288L19.5 11.961L21.2678 13.7288C22.2441 14.7051 22.2441 16.288 21.2678 17.2643C20.2915 18.2407 18.7085 18.2407 17.7322 17.2643C16.7559 16.288 16.7559 14.7051 17.7322 13.7288Z"></path></svg> Creative</a></li></ul><button class="Menu__Item Menu__Item--unselect Menu__Item--bg"><svg fill="currentColor" height="1em" stroke="currentColor" stroke-width="0" viewBox="0 0 512 512" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M433 288.8c-7.7 0-14.3 5.9-14.9 13.6-6.9 83.1-76.8 147.9-161.8 147.9-89.5 0-162.4-72.4-162.4-161.4 0-87.6 70.6-159.2 158.2-161.4 2.3-.1 4.1 1.7 4.1 4v50.3c0 12.6 13.9 20.2 24.6 13.5L377 128c10-6.3 10-20.8 0-27.1l-96.1-66.4c-10.7-6.7-24.6.9-24.6 13.5v45.7c0 2.2-1.7 4-3.9 4C148 99.8 64 184.6 64 288.9 64 394.5 150.1 480 256.3 480c100.8 0 183.4-76.7 191.6-175.1.8-8.7-6.2-16.1-14.9-16.1z"></path></svg> bg upd</button></nav><div class="Wrap"><div class="Page"><a href="/" class="CloseButton" aria-label="Back to the main page" style=""><svg fill="currentColor" height="1em" stroke="currentColor" stroke-width="0" viewBox="0 0 512 512" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M405 136.798L375.202 107 256 226.202 136.798 107 107 136.798 226.202 256 107 375.202 136.798 405 256 285.798 375.202 405 405 375.202 285.798 256z"></path></svg></a><div class="Article Page__Article Page__Inner"><a href="/" class="Article__GoBack">‚Üê All articles</a><div><h1 id="drop-react-manual-memoization">Drop React Manual Memoization</h1><ul><li><a href="#introduction" target="_self">Introduction</a></li><li><a href="#quick-summary" target="_self">Quick Summary</a></li><li><a href="#why-does-react-need-a-mutation-model" target="_self">Why does React need a mutation model?</a></li><li><a href="#building-blocks-places-effects-ranges" target="_self">Building Blocks: Places, Effects & Ranges</a></li><li><a href="#effects-reference" target="_self">Effects Reference</a></li><li><a href="#key-inference-rules-mental-model" target="_self">Key Inference Rules (Mental Model)</a></li><li><a href="#writing-compiler-friendly-code" target="_self">Writing Compiler-Friendly Code</a></li><li><a href="#frequently-asked-questions" target="_self">Frequently Asked Questions</a></li><li><a href="#conclusion" target="_self">Conclusion</a></li></ul><h2 id="note">Note</h2><ul><li>Check <a href="/articles/memoization/">memoization article</a>.</li><li>And <a href="https://github.com/facebook/react/blob/156b7a96f5669470182ad226306184576d6f150f/compiler/packages/babel-plugin-react-compiler/src/Inference/MUTABILITY_ALIASING_MODEL.md" target="_blank">React document</a>.</li></ul><h2 id="introduction">Introduction</h2><p>React Compiler just got a lot smarter. It now understands <em>where</em>, <em>when</em>, and <em>how</em> your data mutates and it uses that <strong>knowledge to memoize components</strong> and hooks automatically.</p><p>For years, React developers have reached for memoization patterns to squeeze extra performance out of their applications. With the <strong>Mutability & Aliasing Model</strong> introduced in <strong>June 2025</strong>, most of that manual work disappears. React Compiler now performs a whole-program analysis that can:</p><ol><li>Detect every value that <em>might</em> mutate.</li><li>Track <em>exactly</em> which instructions cause the mutation.</li><li>Slice the program into <em>reactive scopes</em> that React can memoize safely.</li></ol><p>The result? <em>Cleaner code, fewer bugs, and mental bandwidth back for features.</em></p><hr><h2 id="quick-summary">Quick Summary</h2><p><strong>When creation and mutation are split across multiple instructions:</strong> Compiler skips memoization (unsafe)</p><p><strong>When mutation is scoped in a helper function or block:</strong> Compiler memoizes automatically</p><p>Just keep your mutations local and explicit React Compiler does the rest.</p><hr><h2 id="why-does-react-need-a-mutation-model">Why does React need a mutation model?</h2><p>Traditional virtual-DOM diffing is great at spotting <em>value replacement</em> (new arrays, new objects). It is <strong>terrible</strong> at spotting <em>in-place mutation</em> (<code>array.push</code>, <code>obj.x = 3</code>).</p><p>The Mutability & Aliasing Model fixes that by describing <em>how references flow</em> and <em>where state changes</em>. Once React knows a mutation is <strong>confined</strong> to a scope, it can confidently reuse previously rendered output outside that scope.</p><hr><h2 id="building-blocks-places-effects-ranges">Building Blocks: Places, Effects & Ranges</h2><p>React's analysis operates on three core concepts:</p><ol><li><strong>Place</strong> ‚Äì a single variable or property reference (<code>a</code>, <code>obj.x</code>).</li><li><strong>Effect</strong> ‚Äì a record describing what a single instruction does (create, alias, mutate‚Ä¶).</li><li><strong>Range</strong> ‚Äì a pair of instruction IDs <code>[start, end]</code> over which a value may mutate.</li></ol><p><img alt="Flowchart diagram" src="/api/articles/light/drop-react-manual-memoization-0.svg"></p><pre><details><summary>Show Mermaid Code</summary><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-mermaid" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#569cd6">flowchart</span><span> TD
</span><span>    A</span><span class="token text" style="color:#ce9178">[React&lt;br/>Compiler&lt;br/>Analysis]</span><span> </span><span class="token" style="color:#569cd6">--></span><span> B</span><span class="token text" style="color:#ce9178">[Places]</span><span>
</span><span>    A </span><span class="token" style="color:#569cd6">--></span><span> C</span><span class="token text" style="color:#ce9178">[Effects]</span><span> 
</span><span>    A </span><span class="token" style="color:#569cd6">--></span><span> D</span><span class="token text" style="color:#ce9178">[Ranges]</span><span>
</span>    
<span>    </span><span class="token" style="color:#569cd6">subgraph</span><span> Places </span><span class="token text" style="color:#ce9178">["üè∑Ô∏è Places"]</span><span>
</span><span>        E</span><span class="token text" style="color:#ce9178">[Variables&lt;br/>a, b, c]</span><span>
</span><span>        F</span><span class="token text" style="color:#ce9178">["Properties&lt;br/>obj.x, arr.0"]</span><span>
</span><span>    </span><span class="token" style="color:#569cd6">end</span><span>
</span>    
<span>    </span><span class="token" style="color:#569cd6">subgraph</span><span> Effects </span><span class="token text" style="color:#ce9178">["‚ö° Effects"]</span><span>
</span><span>        G</span><span class="token text" style="color:#ce9178">["Create&lt;br/>const obj = {}"]</span><span>
</span><span>        H</span><span class="token text" style="color:#ce9178">["Mutate&lt;br/>obj.x = 1"]</span><span>
</span><span>        I</span><span class="token text" style="color:#ce9178">["Alias&lt;br/>b = a"]</span><span>
</span><span>        J</span><span class="token text" style="color:#ce9178">["Freeze&lt;br/>props, hooks"]</span><span>
</span><span>    </span><span class="token" style="color:#569cd6">end</span><span>
</span>    
<span>    </span><span class="token" style="color:#569cd6">subgraph</span><span> Ranges </span><span class="token text" style="color:#ce9178">["üìè Ranges"]</span><span>
</span><span>        K</span><span class="token text" style="color:#ce9178">["Instruction IDs&lt;br/>1 to 5"]</span><span>
</span><span>        L</span><span class="token text" style="color:#ce9178">[Mutation&lt;br/>Scope]</span><span>
</span><span>    </span><span class="token" style="color:#569cd6">end</span><span>
</span>    
<span>    B </span><span class="token" style="color:#569cd6">--></span><span> Places
</span><span>    C </span><span class="token" style="color:#569cd6">--></span><span> Effects
</span><span>    D </span><span class="token" style="color:#569cd6">--></span><span> Ranges
</span>    
<span>    L </span><span class="token" style="color:#569cd6">--></span><span> M</span><span class="token text" style="color:#ce9178">[Reactive&lt;br/>Scopes]</span><span>
</span><span>    M </span><span class="token" style="color:#569cd6">--></span><span> N</span><span class="token text" style="color:#ce9178">[Memoization&lt;br/>Boundaries]</span><span>
</span>    
<span>    </span><span class="token" style="color:#569cd6">classDef</span><span> concept </span><span class="token style" style="color:#9cdcfe">fill</span><span class="token style" style="color:#d4d4d4">:</span><span class="token style">#e1f5fe</span><span class="token style" style="color:#d4d4d4">,</span><span class="token style" style="color:#9cdcfe">stroke</span><span class="token style" style="color:#d4d4d4">:</span><span class="token style">#01579b</span><span class="token style" style="color:#d4d4d4">,</span><span class="token style" style="color:#9cdcfe">stroke-width</span><span class="token style" style="color:#d4d4d4">:</span><span class="token style">2px</span><span>
</span><span>    </span><span class="token" style="color:#569cd6">classDef</span><span> output </span><span class="token style" style="color:#9cdcfe">fill</span><span class="token style" style="color:#d4d4d4">:</span><span class="token style">#f3e5f5</span><span class="token style" style="color:#d4d4d4">,</span><span class="token style" style="color:#9cdcfe">stroke</span><span class="token style" style="color:#d4d4d4">:</span><span class="token style">#4a148c</span><span class="token style" style="color:#d4d4d4">,</span><span class="token style" style="color:#9cdcfe">stroke-width</span><span class="token style" style="color:#d4d4d4">:</span><span class="token style">2px</span><span>
</span>    
<span>    </span><span class="token" style="color:#569cd6">class</span><span> A concept
</span><span>    </span><span class="token" style="color:#569cd6">class</span><span> M,N output</span></code></div></details></pre><p>The passes that produce these artefacts run in the following order:</p><ol><li><code>InferMutationAliasingEffects</code> ‚Äì emit a <em>set of effects</em> for each instruction.</li><li><code>InferMutationAliasingRanges</code> ‚Äì collapse effects into per-value <em>mutable ranges</em>.</li><li><code>InferReactiveScopeVariables</code> ‚Äì group Places that mutate together into <em>reactive scopes</em> (future memoization boundaries).</li></ol><p><img alt="Flowchart diagram" src="/api/articles/light/drop-react-manual-memoization-1.svg"></p><pre><details><summary>Show Mermaid Code</summary><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-mermaid" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#569cd6">flowchart</span><span> TD
</span><span>    </span><span class="token" style="color:#569cd6">subgraph</span><span> Passes
</span><span>        A</span><span class="token text" style="color:#ce9178">[InferMutationAliasingEffects]</span><span> </span><span class="token" style="color:#569cd6">--></span><span> B</span><span class="token text" style="color:#ce9178">[InferMutationAliasingRanges]</span><span> </span><span class="token" style="color:#569cd6">--></span><span> C</span><span class="token text" style="color:#ce9178">[InferReactiveScopeVariables]</span><span>
</span><span>    </span><span class="token" style="color:#569cd6">end</span><span>
</span><span>    </span><span class="token" style="color:#569cd6">subgraph</span><span> Output
</span><span>        R</span><span class="token text" style="color:#ce9178">[Reactive Scope &amp#x25B8; memoization block]</span><span>
</span><span>    </span><span class="token" style="color:#569cd6">end</span><span>
</span><span>    C </span><span class="token" style="color:#569cd6">--></span><span> R</span></code></div></details></pre><hr><h2 id="effects-reference">Effects Reference</h2><p>Below is a condensed reference of the effects you will encounter in compiler traces. The full formal spec lives inside React repo, but this covers 99% of day-to-day cases.</p><p><strong>Creation Effects:</strong></p><ul><li><code>Create</code> - Basic value creation like <code>const obj = {}</code></li><li><code>CreateFunction</code> - Arrow functions and function expressions capturing locals</li><li><code>Apply</code> - Function calls, method calls, and constructor calls like <code>new Foo()</code>, <code>fn(arg)</code></li></ul><p><strong>Aliasing and Data-flow Effects:</strong></p><ul><li><code>Assign</code> - Direct assignment that overwrites like <code>x = y</code></li><li><code>Alias</code> - Non-exclusive assignment like <code>return cond ? a : b</code></li><li><code>Capture</code> - Storing references like <code>array.push(item)</code> or <code>obj.key = value</code></li><li><code>CreateFrom</code> - Extracting parts like <code>slice = arr[i]</code> or <code>obj.key</code></li></ul><p><strong>State Change Effects:</strong></p><ul><li><code>Mutate</code> - Direct mutation of a value</li><li><code>Freeze</code> - Passing reference to React boundary (props, hooks, etc.)</li></ul><h3 id="a-minimal-example">A Minimal Example</h3><pre><h3 class="Article__CondingLang">js:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-javascript" style='white-space:pre;color:#9cdcfe;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#569cd6">function</span><span> </span><span class="token" style="color:#dcdcaa">Sample</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#6a9955">// a is created and immediately mutated ‚Üí same reactive scope</span><span>
</span><span>  </span><span class="token" style="color:#569cd6">const</span><span> a </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token literal-property" style="color:#9cdcfe">count</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#b5cea8">0</span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  a</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">count</span><span class="token" style="color:#d4d4d4">++</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span>  </span><span class="token" style="color:#6a9955">// b & c are created together; mutate(c) may mutate b transitively</span><span>
</span><span>  </span><span class="token" style="color:#569cd6">const</span><span> b </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#569cd6">const</span><span> c </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>b</span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#dcdcaa">mutate</span><span class="token" style="color:#d4d4d4">(</span><span>c</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span>  </span><span class="token" style="color:#c586c0">return</span><span> </span><span class="token" style="color:#d4d4d4">&lt;</span><span class="token" style="color:#4ec9b0">Display</span><span> a</span><span class="token" style="color:#d4d4d4">=</span><span class="token" style="color:#d4d4d4">{</span><span>a</span><span class="token" style="color:#d4d4d4">}</span><span> c</span><span class="token" style="color:#d4d4d4">=</span><span class="token" style="color:#d4d4d4">{</span><span>c</span><span class="token" style="color:#d4d4d4">}</span><span> </span><span class="token" style="color:#d4d4d4">/</span><span class="token" style="color:#d4d4d4">></span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span></code></div></pre><p>The compiler produces (simplified):</p><pre><h3 class="Article__CondingLang">text:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-text" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span>1  Create  a
</span>2  Mutate  a          &lt;-- still inside a's range
3  Create  b
4  Create  c
5  Apply   mutate(c)  &lt;-- MutateTransitive b because c captures b
6  Freeze  a,c        &lt;-- passed to JSX</code></div></pre><p>Resulting <em>reactive scopes</em>:</p><ul><li><strong>Scope 1</strong> ‚Äì <code>{a}</code> spanning instructions 1-2</li><li><strong>Scope 2</strong> ‚Äì <code>{b,c}</code> spanning instructions 3-5</li></ul><p>JSX receive occurs <em>after</em> both scopes close, so React can safely memoize each <code>&lt;Display /></code> render.</p><hr><h2 id="key-inference-rules-mental-model">Key Inference Rules (Mental Model)</h2><p>The full formalism is lengthy; here are the 5 rules you actually need to reason about:</p><ol><li><strong>Mutating an alias mutates the source</strong><br><code>Alias a ‚Üê b</code> <em>then</em> <code>Mutate a</code> ‚áí <code>Mutate b</code></li><li><strong>Mutating an assignment mutates the source</strong><br><code>Assign a ‚Üê b</code> <em>then</em> <code>Mutate a</code> ‚áí <code>Mutate b</code></li><li><strong>Mutating a view (<code>CreateFrom</code>) mutates container transitively</strong><br><code>CreateFrom part ‚Üê whole</code> <em>then</em> <code>Mutate part</code> ‚áí <code>MutateTransitive whole</code></li><li><strong>Mutation of a capture <em>does NOT</em> mutate the captured value</strong><br><code>Capture obj ‚Üê value</code> <em>then</em> <code>Mutate obj</code> ‚áí <code>// value untouched</code></li><li><strong>Freeze forbids further mutation <em>through that reference</em> ‚Äì not globally</strong><br>You may still mutate the underlying object via another alias.</li></ol><p>A handy mnemonic: <strong>A.A.C.F</strong> ‚Äì <em>Aliases</em>, <em>Assignments</em>, <em>CreateFrom</em> propagate; <em>Freeze</em> restricts reference.</p><hr><h2 id="writing-compiler-friendly-code">Writing Compiler-Friendly Code</h2><p>The new compiler is <em>extremely</em> good at inferring scopes, but a few patterns still trip it up.</p><h3 id="do-localise-mutation">Do ‚Äì Localise Mutation</h3><pre><h3 class="Article__CondingLang">js:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-javascript" style='white-space:pre;color:#9cdcfe;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#569cd6">function</span><span> </span><span class="token" style="color:#dcdcaa">increment</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#569cd6">const</span><span> counter </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token literal-property" style="color:#9cdcfe">value</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#b5cea8">0</span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  counter</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">value</span><span> </span><span class="token" style="color:#d4d4d4">+=</span><span> </span><span class="token" style="color:#b5cea8">1</span><span class="token" style="color:#d4d4d4">;</span><span> </span><span class="token" style="color:#6a9955">// Local + obvious</span><span>
</span><span>  </span><span class="token" style="color:#c586c0">return</span><span> counter</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">value</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span></code></div></pre><h3 id="don-t-split-creation-mutation-far-apart">Don't ‚Äì Split Creation & Mutation Far Apart</h3><pre><h3 class="Article__CondingLang">js:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-javascript" style='white-space:pre;color:#9cdcfe;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#569cd6">const</span><span> data </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span></span><span class="token" style="color:#6a9955">// ‚Ä¶ 50 lines later ‚Ä¶</span><span>
</span><span>data</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">x</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#b5cea8">1</span><span class="token" style="color:#d4d4d4">;</span><span> </span><span class="token" style="color:#6a9955">// Compiler must keep huge range open, skips memoization</span></code></div></pre><h3 id="do-use-helper-functions-to-scope-mutation">Do ‚Äì Use Helper Functions To Scope Mutation</h3><pre><h3 class="Article__CondingLang">js:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-javascript" style='white-space:pre;color:#9cdcfe;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#569cd6">function</span><span> </span><span class="token" style="color:#dcdcaa">initUser</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#9cdcfe">raw</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#569cd6">const</span><span> user </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span> </span><span class="token spread" style="color:#d4d4d4">...</span><span>raw </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span>  </span><span class="token" style="color:#dcdcaa">normalise</span><span class="token" style="color:#d4d4d4">(</span><span>user</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span> </span><span class="token" style="color:#6a9955">// compiler sees mutation lives inside helper</span><span>
</span><span>  </span><span class="token" style="color:#c586c0">return</span><span> user</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span></code></div></pre><h3 id="don-t-mutate-after-freezing">Don't ‚Äì Mutate After Freezing</h3><pre><h3 class="Article__CondingLang">js:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-javascript" style='white-space:pre;color:#9cdcfe;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#569cd6">function</span><span> </span><span class="token" style="color:#dcdcaa">Item</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">{</span><span class="token" style="color:#9cdcfe">config</span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#dcdcaa">useEffect</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#569cd6">=></span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    config</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">enabled</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#569cd6">true</span><span class="token" style="color:#d4d4d4">;</span><span> </span><span class="token" style="color:#6a9955">// Mutating a frozen reference</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#d4d4d4">]</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span></code></div></pre><p>The compiler will surface a <strong>MutateFrozen</strong> error and bail out of optimisation.</p><hr><h2 id="frequently-asked-questions">Frequently Asked Questions</h2><h3 id="-does-this-replace-usememo-entirely">"Does this replace <code>useMemo</code> entirely?"</h3><p><em>In most cases, yes.</em> Manual memoization becomes necessary only when your code relies on dynamic <em>identity</em> checks outside React's reach (e.g. caching in a global Map).</p><h3 id="-what-about-mutable-refs-useref">"What about mutable refs (<code>useRef</code>)?"</h3><p>Refs are tracked like any other value. The compiler keeps their mutation range open until the final render-commit.</p><h3 id="-how-do-i-debug-scopes">"How do I debug scopes?"</h3><p>Run <code>REACT_DEBUG_COMPILER=1 npm start</code>. Instruction ranges and reactive scopes are printed next to your source lines.</p><hr><h2 id="conclusion">Conclusion</h2><p>The Mutability & Aliasing Model is the biggest leap in React performance ergonomics since hooks. By modelling how your data <em>really</em> flows, React Compiler can:</p><ul><li>Generate optimal memoization boundaries automatically.</li><li>Warn you when a sneaky mutation would break reactivity.</li><li>Unlock future optimisations like partial hydration and server components that depend on precise side-effect tracking.</li></ul><p>In practice, you only need to remember one rule:</p><blockquote><p><strong>Structure your mutation logic clearly and locally.</strong> React will take it from there.</p></blockquote></div></div></div></div><footer class="Footer">The API for this site <a href="https://github.com/shapkarin/shapkarin.me/tree/master/src/Generate-Backend" target="_blank" rel="noreferrer">is generated</a><svg fill="none" height="1em" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg> and stored as <a href="https://github.com/shapkarin/shapkarin.me/tree/gh-@/Pages/api" target="_blank" rel="noreferrer">JSON and Markdown</a><svg fill="none" height="1em" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg> on GitHub Pages.<br>It <a href="https://github.com/shapkarin/shapkarin.me/blob/main/.github/workflows/build-deploy.yml" target="_blank" rel="noreferrer">uses Github Actions<svg fill="none" height="1em" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg></a>to help with CI and generates a static version.</footer></div><canvas height="850" id="background" width="480"></canvas></body></html>