<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link href="/favicon/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png"><link href="/favicon/favicon.svg" rel="icon" type="image/svg+xml"><link href="/favicon/favicon.ico" rel="shortcut icon"><link href="/favicon/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"><meta content="shapkarin.me" name="apple-mobile-web-app-title"><link href="/favicon/site.webmanifest" rel="manifest"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="#000000" name="theme-color"><title>LavaMoat: Protecting JavaScript from Supply Chain Attacks | Yuri Shapkarin</title><meta content="Yuri Shapkarin's personal website. Experienced Software Engineer." name="description"><script type="text/javascript">!function(){"use strict";!function(){const e=window.location;let t=e.pathname;if(e.pathname.endsWith("//")&&(t=e.pathname.replace(/\/+$/,"/")||"/",console.log("Normalized double trailing slash:",t+e.search+e.hash)),t!==e.pathname){var a=document.createElement("link");a.setAttribute("rel","canonical"),a.setAttribute("href",t),document.head.appendChild(a),window.location.replace(t+e.search+e.hash)}}()}()</script><meta content="website" property="og:type"><meta content="Yuri Shapkarin | Software Developer" property="og:title"><meta content="Yuri Shapkarin's personal website" property="og:description"><meta content="https://shapkarin.me" property="og:url"><meta content="Yuri Shapkarin" name="twitter:creator"><meta content="website" name="twitter:card"><meta content="Yuri Shapkarin | Software Developer" name="twitter:title"><meta content="Yuri Shapkarin's personal website" name="twitter:description"><link href="https://fonts.googleapis.com/css?family=Lato:300" rel="stylesheet"><title>Yuri Shapkarin</title><link href="https://fonts.googleapis.com" rel="preconnect"><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin=""><link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet"><script defer src="/static/js/main.4c546719.js"></script><link href="/static/css/main.9e6f6fb8.css" rel="stylesheet"><link href="https://fonts.googleapis.com" rel="preconnect"><link href="https://fonts.gstatic.com" rel="preconnect"><link href="https://raw.githubusercontent.com" rel="preconnect"><link href="https://shapkarin.me/articles/LavaMoat-against-JS-supply-chain-attacks/" rel="canonical" data-react-helmet="true"><meta content="Explore LavaMoat, an open-source toolset designed to secure JavaScript applications against supply chain attacks by compartmentalizing dependencies and controlling access during installation, build, and runtime." name="description" data-react-helmet="true"><meta content="LavaMoat, JavaScript security, supply chain attacks, npm security, runtime protection, allow-scripts, lavamoat-node, SES, compartmentalization, dependency sandboxing" name="keywords" data-react-helmet="true"><meta content="article" data-react-helmet="true" property="og:type"><meta content="LavaMoat: Protecting JavaScript from Supply Chain Attacks | Yuri Shapkarin" data-react-helmet="true" property="og:title"><meta content="Explore LavaMoat, an open-source toolset designed to secure JavaScript applications against supply chain attacks by compartmentalizing dependencies and controlling access during installation, build, and runtime." data-react-helmet="true" property="og:description"><meta content="https://shapkarin.me/articles/LavaMoat-against-JS-supply-chain-attacks/" data-react-helmet="true" property="og:url"><meta content="Yuri Shapkarin" name="twitter:creator" data-react-helmet="true"><meta content="article" name="twitter:card" data-react-helmet="true"><meta content="LavaMoat: Protecting JavaScript from Supply Chain Attacks | Yuri Shapkarin" name="twitter:title" data-react-helmet="true"><meta content="Explore LavaMoat, an open-source toolset designed to secure JavaScript applications against supply chain attacks by compartmentalizing dependencies and controlling access during installation, build, and runtime." name="twitter:description" data-react-helmet="true"><script type="application/ld+json" data-react-helmet="true">[{"@context":"https://schema.org","@type":"Article","learningResourceType":["tutorial","reading"],"educationalUse":["learning","teaching","presentation"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://shapkarin.me/articles/lavamoat-protecting-javascript"},"url":"https://shapkarin.me/articles/lavamoat-protecting-javascript","headline":"LavaMoat: Protecting JavaScript from Supply Chain Attacks","description":"Explore LavaMoat, an open-source toolset designed to secure JavaScript applications against supply chain attacks by compartmentalizing dependencies and controlling access during installation, build, and runtime.","image":[{"@type":"ImageObject","url":"https://shapkarin.me/lavamoat-og-image.jpg","width":1200,"height":630},{"@type":"ImageObject","url":"https://shapkarin.me/api/articles/dark/LavaMoat-against-JS-supply-chain-attacks-1.svg"},{"@type":"ImageObject","url":"https://shapkarin.me/api/articles/light/LavaMoat-against-JS-supply-chain-attacks-2.svg"},{"@type":"ImageObject","url":"https://shapkarin.me/api/articles/light/LavaMoat-against-JS-supply-chain-attacks-3.svg"}],"author":{"@type":"Person","name":"Yuri Shapkarin","alternateName":"Yuri Shapkarin","url":"https://shapkarin.me"},"publisher":{"@type":"Person","name":"Yuri Shapkarin","alternateName":"Yuri Shapkarin","logo":{"@type":"ImageObject","url":"https://shapkarin.me/logo.jpg","width":512,"height":512}},"datePublished":"2025-10-12","dateModified":"2025-10-12","wordCount":870,"inLanguage":"en-US","proficiencyLevel":["Beginner","Intermediate"],"keywords":"LavaMoat, JavaScript security, supply chain attacks, npm security, runtime protection, allow-scripts, lavamoat-node, SES, compartmentalization, dependency sandboxing","about":[{"@type":"Thing","name":"LavaMoat","description":"Open-source suite of tools for securing JavaScript projects against software supply chain attacks through sandboxing and access controls"},{"@type":"Thing","name":"Supply Chain Attacks","description":"Security threats in JavaScript ecosystems where malicious dependencies compromise applications during installation, build, or runtime"},{"@type":"Thing","name":"Secure EcmaScript (SES)","description":"Technology used by LavaMoat to create isolated compartments for dependencies, enforcing strict permissions"},{"@type":"Thing","name":"@lavamoat/allow-scripts","description":"Tool for controlling lifecycle scripts during npm or Yarn installations to prevent malicious executions"},{"@type":"Thing","name":"lavamoat-node","description":"Runtime environment for Node.js applications with policy-enforced sandboxing"},{"@type":"Thing","name":"Prototype Pollution","description":"Vulnerability prevented by LavaMoat through primordial protection and lockdown mechanisms"},{"@type":"Thing","name":"MetaMask","description":"Production project utilizing LavaMoat for securing browser extensions and serving millions of users"}],"audience":[{"@type":"Audience","audienceType":"Developers","name":"JavaScript Developers"},{"@type":"Audience","audienceType":"Developers","name":"Frontend Developers"},{"@type":"Audience","audienceType":"Developers","name":"Backend Developers"},{"@type":"Audience","audienceType":"Developers","name":"Node.js Developers"},{"@type":"Audience","audienceType":"Developers","name":"Security Engineers"},{"@type":"Audience","audienceType":"Developers","name":"Blockchain Developers"},{"@type":"Audience","audienceType":"Product Managers","name":"Technical Product Managers"}],"citation":[{"@type":"LavaMoat Official Site","name":"LavaMoat Docs","@id":"https://lavamoat.github.io","description":"Official documentation for LavaMoat, overview of LavaMoat tools for JavaScript supply chain security, covering installation, configuration, usage guides, and best practices for securing JavaScript applications"},{"@type":"WebPage","name":"GitHub Repo - LavaMoat","@id":"https://github.com/LavaMoat/LavaMoat","description":"Official source code and documentation for LavaMoat tools, including allow-scripts, lavamoat-node, and policy configurations","relatedLink":["https://github.com/LavaMoat/LavaMoat/tree/main/packages/allow-scripts","https://github.com/LavaMoat/LavaMoat/blob/main/docs/policy.md"]},{"@type":"WebPage","name":"GitHub Organisation - LavaMoat","@id":"https://github.com/LavaMoat","description":"GitHub organization hosting LavaMoat projects, repositories, contributors, and related open-source security tools"}],"hasPart":[{"@type":"WebPageElement","name":"Introduction","url":"https://shapkarin.me/articles/lavamoat-protecting-javascript#introduction","description":"Overview of supply chain threats in JavaScript and LavaMoat's role in mitigation"},{"@type":"WebPageElement","name":"What is LavaMoat?","url":"https://shapkarin.me/articles/lavamoat-protecting-javascript#what-is-lavamoat","description":"Detailed explanation of LavaMoat as an open-source toolset leveraging SES for dependency sandboxing"},{"@type":"WebPageElement","name":"How LavaMoat Works","url":"https://shapkarin.me/articles/lavamoat-protecting-javascript#how-lavamoat-works","description":"Breakdown of installation protection, build/runtime sandboxing, policy enforcement, and primordial protection"},{"@type":"WebPageElement","name":"Key Features","url":"https://shapkarin.me/articles/lavamoat-protecting-javascript#key-features","description":"Proactive security, automated configuration, bundler integration, and open-source backing by MetaMask"},{"@type":"WebPageElement","name":"Installation and Setup","url":"https://shapkarin.me/articles/lavamoat-protecting-javascript#installation-and-setup","description":"Step-by-step guide to installing @lavamoat/allow-scripts and lavamoat via npm or Yarn"},{"@type":"WebPageElement","name":"Using @lavamoat/allow-scripts for Installation Security","url":"https://shapkarin.me/articles/lavamoat-protecting-javascript#using-lavamoatallow-scripts-for-installation-security","description":"Configuring allowlists, auto-generation, and integration into workflows"},{"@type":"WebPageElement","name":"Runtime Protection with lavamoat-node","url":"https://shapkarin.me/articles/lavamoat-protecting-javascript#runtime-protection-with-lavamoat-node","description":"Running Node.js apps with policy enforcement and automatic policy generation"},{"@type":"WebPageElement","name":"Browser Bundling with LavaMoat Plugins","url":"https://shapkarin.me/articles/lavamoat-protecting-javascript#browser-bundling-with-lavamot-plugins","description":"Integration with Browserify and Webpack for secure browser bundles"},{"@type":"WebPageElement","name":"Policy Files and Configuration","url":"https://shapkarin.me/articles/lavamoat-protecting-javascript#policy-files-and-configuration","description":"Structure of policy.json, overrides, and permission definitions for globals and dependencies"},{"@type":"WebPageElement","name":"Benefits and Use Cases","url":"https://shapkarin.me/articles/lavamoat-protecting-javascript#benefits-and-use-cases","description":"Attack mitigation, production use in MetaMask, and applications in blockchain and web development"},{"@type":"WebPageElement","name":"Conclusion","url":"https://shapkarin.me/articles/lavamoat-protecting-javascript#conclusion","description":"Summary of LavaMoat's empowerment for secure JavaScript development"},{"@type":"WebPageElement","name":"Resources and Links","url":"https://shapkarin.me/articles/lavamoat-protecting-javascript#resources-and-links","description":"Curated list of official LavaMoat documentation, GitHub repository, and organization for further reading and contributions"}],"teaches":["How to secure JavaScript projects against supply chain attacks using LavaMoat","Implementing installation protection with @lavamoat/allow-scripts to control lifecycle scripts","Configuring runtime sandboxing in Node.js applications with lavamoat-node","Integrating LavaMoat plugins for Browserify and Webpack in browser environments","Generating and customizing LavaMoat policy files for per-package permissions","Visualizing dependency risks and applying primordial protections","Best practices for LavaMoat in blockchain wallets and web applications"],"programmingLanguage":["JavaScript"],"operatingSystem":"Cross-platform","applicationCategory":"Educational"}]</script></head><body><div id="root"><a href="#menu" class="a11y hidden">Go to Menu</a><div class="About"><a href="/" class="About_greeting">Hello everyone!</a> My name is Yuri Shapkarin. I am a software engineer with over a decade of experience and a solid foundation in Computer Science. My work reflects a firm commitment to innovation, problem-solving, and delivering exceptional user experiences.<a href="https://www.linkedin.com/in/shapkarin" target="_blank" rel="noreferrer" class="Social_Link">LinkedIn<svg fill="none" height="12" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="12" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round" style="margin-left:2px"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg></a><a href="https://github.com/shapkarin" target="_blank" rel="noreferrer" class="Social_Link">GitHub<svg fill="none" height="12" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="12" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round" style="margin-left:2px"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg></a><span class="About_email">Get my email</span><em class="Disclaimer">Disclaimer: homepage has been gradually developed <a href="https://web.archive.org/web/20130801000000*/shapkarin.me" target="_blank" rel="noreferrer">since 2013<svg fill="none" height="12" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="12" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round" style="margin-left:2px"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg></a>with limited time | <a href="https://github.com/shapkarin/shapkarin.me" target="_blank" rel="noreferrer">cource code<svg fill="none" height="12" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="12" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round" style="margin-left:2px"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg></a></em></div><nav aria-label="Main Menu" class="Menu" id="menu" role="navigation"><ul class="Menu_List"><li class="Menu_List_Item"><a href="/" class="Menu__Item"><svg fill="currentColor" height="1.2em" stroke="currentColor" stroke-width="0" viewBox="0 0 24 24" width="1.2em" xmlns="http://www.w3.org/2000/svg"><path d="M11.03 2.59a1.501 1.501 0 0 1 1.94 0l7.5 6.363a1.5 1.5 0 0 1 .53 1.144V19.5a1.5 1.5 0 0 1-1.5 1.5h-5.75a.75.75 0 0 1-.75-.75V14h-2v6.25a.75.75 0 0 1-.75.75H4.5A1.5 1.5 0 0 1 3 19.5v-9.403c0-.44.194-.859.53-1.144ZM12 3.734l-7.5 6.363V19.5h5v-6.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v6.25h5v-9.403Z"></path></svg> Home</a></li><li class="Menu_List_Item"><a href="/articles/" class="Menu__Item"><svg fill="currentColor" height="1em" stroke="currentColor" stroke-width="0" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M20 22H4C3.44772 22 3 21.5523 3 21V3C3 2.44772 3.44772 2 4 2H20C20.5523 2 21 2.44772 21 3V21C21 21.5523 20.5523 22 20 22ZM19 20V4H5V20H19ZM7 6H11V10H7V6ZM7 12H17V14H7V12ZM7 16H17V18H7V16ZM13 7H17V9H13V7Z"></path></svg> Articles</a></li><li class="Menu_List_Item"><a href="/github/repositories/" class="Menu__Item"><svg fill="currentColor" height="1em" stroke="currentColor" stroke-width="0" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3 2.75A2.75 2.75 0 0 1 5.75 0h14.5a.75.75 0 0 1 .75.75v20.5a.75.75 0 0 1-.75.75h-6a.75.75 0 0 1 0-1.5h5.25v-4H6A1.5 1.5 0 0 0 4.5 18v.75c0 .716.43 1.334 1.05 1.605a.75.75 0 0 1-.6 1.374A3.251 3.251 0 0 1 3 18.75ZM19.5 1.5H5.75c-.69 0-1.25.56-1.25 1.25v12.651A2.989 2.989 0 0 1 6 15h13.5Z"></path><path d="M7 18.25a.25.25 0 0 1 .25-.25h5a.25.25 0 0 1 .25.25v5.01a.25.25 0 0 1-.397.201l-2.206-1.604a.25.25 0 0 0-.294 0L7.397 23.46a.25.25 0 0 1-.397-.2v-5.01Z"></path></svg> Repositories</a></li><li class="Menu_List_Item"><a href="/github/likes/" class="Menu__Item"><svg fill="currentColor" height="1.2em" stroke="currentColor" stroke-width="0" viewBox="0 0 24 24" width="1.2em" xmlns="http://www.w3.org/2000/svg"><path d="M12 .25a.75.75 0 0 1 .673.418l3.058 6.197 6.839.994a.75.75 0 0 1 .415 1.279l-4.948 4.823 1.168 6.811a.751.751 0 0 1-1.088.791L12 18.347l-6.117 3.216a.75.75 0 0 1-1.088-.79l1.168-6.812-4.948-4.823a.75.75 0 0 1 .416-1.28l6.838-.993L11.328.668A.75.75 0 0 1 12 .25Zm0 2.445L9.44 7.882a.75.75 0 0 1-.565.41l-5.725.832 4.143 4.038a.748.748 0 0 1 .215.664l-.978 5.702 5.121-2.692a.75.75 0 0 1 .698 0l5.12 2.692-.977-5.702a.748.748 0 0 1 .215-.664l4.143-4.038-5.725-.831a.75.75 0 0 1-.565-.41L12 2.694Z"></path></svg> Likes</a></li><li class="Menu_List_Item"><a href="/packages/" class="Menu__Item"><svg fill="currentColor" height="1.24em" stroke="currentColor" stroke-width="0" viewBox="0 0 24 24" width="1.24em" xmlns="http://www.w3.org/2000/svg"><path d="M20.001 3C20.5533 3 21.001 3.44772 21.001 4V20C21.001 20.5523 20.5533 21 20.001 21H4.00098C3.44869 21 3.00098 20.5523 3.00098 20V4C3.00098 3.44772 3.44869 3 4.00098 3H20.001ZM19.001 5H5.00098V19H19.001V5ZM17.001 7V17H14.501V9.5H12.001V17H7.00098V7H17.001Z"></path></svg> Packages</a></li><li class="Menu_List_Item"><a href="/creative/" class="Menu__Item"><svg fill="currentColor" height="1em" stroke="currentColor" stroke-width="0" viewBox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4 2.99658H20C20.5523 2.99658 21 3.4443 21 3.99658V8.99658C21 9.54887 20.5523 9.99658 20 9.99658H4C3.44772 9.99658 3 9.54887 3 8.99658V3.99658C3 3.4443 3.44772 2.99658 4 2.99658ZM6 11.9966H12C12.5523 11.9966 13 12.4443 13 12.9966V15.9966H14V21.9966H10V15.9966H11V13.9966H5C4.44772 13.9966 4 13.5489 4 12.9966V10.9966H6V11.9966ZM17.7322 13.7288L19.5 11.961L21.2678 13.7288C22.2441 14.7051 22.2441 16.288 21.2678 17.2643C20.2915 18.2407 18.7085 18.2407 17.7322 17.2643C16.7559 16.288 16.7559 14.7051 17.7322 13.7288Z"></path></svg> Creative</a></li></ul><button class="Menu__Item Menu__Item--unselect Menu__Item--bg"><svg fill="currentColor" height="1em" stroke="currentColor" stroke-width="0" viewBox="0 0 512 512" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M433 288.8c-7.7 0-14.3 5.9-14.9 13.6-6.9 83.1-76.8 147.9-161.8 147.9-89.5 0-162.4-72.4-162.4-161.4 0-87.6 70.6-159.2 158.2-161.4 2.3-.1 4.1 1.7 4.1 4v50.3c0 12.6 13.9 20.2 24.6 13.5L377 128c10-6.3 10-20.8 0-27.1l-96.1-66.4c-10.7-6.7-24.6.9-24.6 13.5v45.7c0 2.2-1.7 4-3.9 4C148 99.8 64 184.6 64 288.9 64 394.5 150.1 480 256.3 480c100.8 0 183.4-76.7 191.6-175.1.8-8.7-6.2-16.1-14.9-16.1z"></path></svg> bg upd</button></nav><div class="Wrap"><div class="Page"><a href="/" class="CloseButton" aria-label="Back to the main page" style=""><svg fill="currentColor" height="1em" stroke="currentColor" stroke-width="0" viewBox="0 0 512 512" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M405 136.798L375.202 107 256 226.202 136.798 107 107 136.798 226.202 256 107 375.202 136.798 405 256 285.798 375.202 405 405 375.202 285.798 256z"></path></svg></a><div class="Article Page__Article Page__Inner"><a href="/articles/" class="Article__GoBack">← All articles</a><div><h1 id="lavamoat-protecting-javascript-from-supply-chain-attacks">LavaMoat: Protecting JavaScript from Supply Chain Attacks</h1><h2 id="table-of-contents">Table of Contents</h2><ul><li><a href="#introduction" target="_self">Introduction</a></li><li><a href="#what-is-lavamoat" target="_self">What is LavaMoat?</a></li><li><a href="#how-lavamoat-works" target="_self">How LavaMoat Works</a></li><li><a href="#key-features" target="_self">Key Features</a></li><li><a href="#installation-and-setup" target="_self">Installation and Setup</a></li><li><a href="#using-lavamoat-allow-scripts-for-installation-security" target="_self">Using @lavamoat/allow-scripts for Installation Security</a></li><li><a href="#runtime-protection-with-lavamoat-node" target="_self">Runtime Protection with lavamoat-node</a></li><li><a href="#browser-bundling-with-lavamoat-plugins" target="_self">Browser Bundling with LavaMoat Plugins</a></li><li><a href="#policy-files-and-configuration" target="_self">Policy Files and Configuration</a></li><li><a href="#benefits-and-use-cases" target="_self">Benefits and Use Cases</a></li><li><a href="#conclusion" target="_self">Conclusion</a></li></ul><h2 id="introduction">Introduction</h2><p>In the modern JavaScript ecosystem, supply chain attacks pose a significant threat. Malicious dependencies can compromise applications, stealing sensitive data or introducing vulnerabilities. LavaMoat, developed by the team behind MetaMask and supported by organizations like ConsenSys and Agoric, offers a robust solution to mitigate these risks. This article delves into LavaMoat's capabilities, providing practical guidance on its implementation to enhance your project's security.</p><h2 id="what-is-lavamoat">What is LavaMoat?</h2><p>LavaMoat is a suite of open-source tools designed to secure JavaScript projects against supply chain attacks. It protects applications at multiple stages: dependency installation, build time, and runtime. By sandboxing dependencies and enforcing strict access controls, LavaMoat prevents malicious code from accessing sensitive APIs or modifying core JavaScript primitives.</p><p>The tool leverages Secure EcmaScript (SES) to create isolated compartments for each package, ensuring that dependencies operate with only the permissions they require. LavaMoat is particularly valuable for frontend and backend JavaScript applications, including those in the blockchain and cryptocurrency spaces, where security is paramount.</p><h2 id="how-lavamoat-works">How LavaMoat Works</h2><p>LavaMoat operates through a combination of preventive measures:</p><ol><li><p><strong>Installation Protection</strong>: Using <code>@lavamoat/allow-scripts</code>, it disables automatic execution of lifecycle scripts (e.g., postinstall) by default and requires an explicit allowlist in <code>package.json</code>.</p></li><li><p><strong>Build and Runtime Sandboxing</strong>: Tools like <code>lavamoat-node</code> and bundler plugins (e.g., for Browserify or Webpack) wrap dependencies in SES compartments. This limits access to powerful APIs like <code>process.env</code> or network requests.</p></li><li><p><strong>Policy Enforcement</strong>: A generated policy file defines per-package permissions. LavaMoat uses static analysis to create an initial policy, which can be customized via overrides.</p></li><li><p><strong>Primordial Protection</strong>: It prevents prototype pollution on JavaScript intrinsics (e.g., Object, Array) using lockdown mechanisms.</p></li></ol><p>This compartmentalization ensures that even if a dependency is compromised, its impact is contained.</p><h2 id="key-features">Key Features</h2><ul><li><strong>Proactive Runtime Security</strong>: Restricts API access to minimize damage from malicious packages.</li><li><strong>Automated Configuration</strong>: Generates allowlists and policies with minimal manual intervention.</li><li><strong>Bundler Integration</strong>: Supports Browserify, Webpack, and others for browser environments.</li><li><strong>Dependency Visualization</strong>: (Currently unmaintained) Tools like <code>lavamoat-viz</code> to assess risk in dependency graphs.</li><li><strong>Optional Advanced Security</strong>: Features like scuttling for enhanced protections.</li><li><strong>Free and Open-Source</strong>: Backed by real-world usage in projects like MetaMask, serving millions of users.</li></ul><p>Outline the key features and their categories:</p><p><img alt="Diagram" src="/api/articles/light/LavaMoat-against-JS-supply-chain-attacks-0.svg"></p><pre><details><summary>Show Mermaid Code</summary><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-mermaid" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span>mindmap
</span><span>  root</span><span class="token text" style="color:#ce9178">((LavaMoat Features))</span><span>
</span>    Security
      Proactive Runtime Security
      Primordial Protection
      Compartmentalization
    Automation
      Automated Configuration
      Policy Generation
    Integration
      Bundler Plugins
      Node.js Support
    Other
      Dependency Visualization
      Open-Source</code></div></details></pre><h2 id="installation-and-setup">Installation and Setup</h2><p>To get started with LavaMoat, install the relevant packages via npm or Yarn. Begin with the installation security tool:</p><pre><h3 class="Article__CondingLang">bash:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-bash" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#dcdcaa">npm</span><span> </span><span class="token" style="color:#dcdcaa">install</span><span> --save-dev @lavamoat/allow-scripts</span></code></div></pre><p>Or with Yarn:</p><pre><h3 class="Article__CondingLang">bash:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-bash" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#dcdcaa">yarn</span><span> </span><span class="token" style="color:#dcdcaa">add</span><span> -D @lavamoat/allow-scripts</span></code></div></pre><p>For runtime protection in Node.js:</p><pre><h3 class="Article__CondingLang">bash:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-bash" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#dcdcaa">npm</span><span> </span><span class="token" style="color:#dcdcaa">install</span><span> --save-dev lavamoat</span></code></div></pre><p>Initialize the setup:</p><pre><h3 class="Article__CondingLang">bash:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-bash" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#dcdcaa">npm</span><span> </span><span class="token" style="color:#4ec9b0">exec</span><span> allow-scripts setup</span></code></div></pre><p>This configures your project to disable automatic script execution and prepares the allowlist.</p><h2 id="using-lavamoat-allow-scripts-for-installation-security">Using @lavamoat/allow-scripts for Installation Security</h2><p><code>@lavamoat/allow-scripts</code> safeguards the dependency installation phase by controlling lifecycle scripts.</p><h3 id="auto-generate-allowlist">Auto-Generate Allowlist</h3><pre><h3 class="Article__CondingLang">bash:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-bash" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#dcdcaa">npm</span><span> </span><span class="token" style="color:#4ec9b0">exec</span><span> allow-scripts auto</span></code></div></pre><p>This scans your dependencies and updates <code>package.json</code> with an initial configuration.</p><h3 id="example-package-json-configuration">Example package.json Configuration</h3><pre><h3 class="Article__CondingLang">json:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-json" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#9cdcfe">"lavamoat"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#9cdcfe">"allowScripts"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#9cdcfe">"keccak"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#569cd6">true</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      </span><span class="token" style="color:#9cdcfe">"core-js"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#569cd6">false</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      </span><span class="token" style="color:#9cdcfe">"@lavamoat/preinstall-always-fail"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#569cd6">true</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span></code></div></pre><p>Here, <code>keccak</code> is allowed to run scripts, while <code>core-js</code> is denied. The <code>@lavamoat/preinstall-always-fail</code> package ensures early failure if protections are bypassed.</p><h3 id="running-allowed-scripts">Running Allowed Scripts</h3><pre><h3 class="Article__CondingLang">bash:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-bash" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#dcdcaa">npm</span><span> </span><span class="token" style="color:#4ec9b0">exec</span><span> allow-scripts</span></code></div></pre><p>Integrate into your workflow by adding a setup script:</p><pre><h3 class="Article__CondingLang">json:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-json" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#9cdcfe">"scripts"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#9cdcfe">"setup"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">"npm install && npm exec allow-scripts && tsc -b"</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span></code></div></pre><p>For Yarn Berry (v3+), import the plugin:</p><pre><h3 class="Article__CondingLang">bash:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-bash" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#dcdcaa">yarn</span><span> plugin </span><span class="token" style="color:#dcdcaa">import</span><span> https://raw.githubusercontent.com/LavaMoat/LavaMoat/main/packages/yarn-plugin-allow-scripts/bundles/@yarnpkg/plugin-allow-scripts.js</span></code></div></pre><h2 id="runtime-protection-with-lavamoat-node">Runtime Protection with lavamoat-node</h2><p>For Node.js environments, use <code>lavamoat-node</code> to enforce policies during execution.</p><h3 id="basic-usage">Basic Usage</h3><p>Run your application with LavaMoat:</p><pre><h3 class="Article__CondingLang">bash:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-bash" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span>lavamoat app.js</span></code></div></pre><h3 id="generate-policy-automatically">Generate Policy Automatically</h3><pre><h3 class="Article__CondingLang">bash:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-bash" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span>lavamoat app.js --autopolicy</span></code></div></pre><p>This creates a <code>policy.json</code> file in <code>./lavamoat/node/</code>.</p><h3 id="example-script-in-package-json">Example Script in package.json</h3><pre><h3 class="Article__CondingLang">json:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-json" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#9cdcfe">"scripts"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#9cdcfe">"lavamoat-policy"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">"lavamoat app.js --autopolicy"</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>    </span><span class="token" style="color:#9cdcfe">"start"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">"lavamoat app.js"</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span></code></div></pre><p> Runtime protection process:</p><p><img alt="SequenceDiagram diagram" src="/api/articles/light/LavaMoat-against-JS-supply-chain-attacks-1.svg"></p><pre><details><summary>Show Mermaid Code</summary><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-mermaid" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#569cd6">sequenceDiagram</span><span>
</span><span>    </span><span class="token" style="color:#569cd6">participant</span><span> User
</span><span>    </span><span class="token" style="color:#569cd6">participant</span><span> LavaMoat
</span><span>    </span><span class="token" style="color:#569cd6">participant</span><span> App
</span><span>    </span><span class="token" style="color:#569cd6">participant</span><span> Dependency
</span><span>    User</span><span class="token" style="color:#569cd6">->></span><span>LavaMoat</span><span class="token" style="color:#d4d4d4">:</span><span> Run app with lavamoat-node
</span><span>    LavaMoat</span><span class="token" style="color:#569cd6">->></span><span>App</span><span class="token" style="color:#d4d4d4">:</span><span> Load entry point
</span><span>    App</span><span class="token" style="color:#569cd6">->></span><span>Dependency</span><span class="token" style="color:#d4d4d4">:</span><span> Require dependency
</span><span>    LavaMoat</span><span class="token" style="color:#569cd6">->></span><span>LavaMoat</span><span class="token" style="color:#d4d4d4">:</span><span> Check policy for dependency
</span><span>    </span><span class="token" style="color:#569cd6">alt</span><span> Allowed Access
</span><span>        LavaMoat</span><span class="token" style="color:#569cd6">->></span><span>Dependency</span><span class="token" style="color:#d4d4d4">:</span><span> Grant limited APIs
</span><span>        Dependency</span><span class="token" style="color:#569cd6">-->></span><span>App</span><span class="token" style="color:#d4d4d4">:</span><span> Execute safely
</span><span>    </span><span class="token" style="color:#569cd6">else</span><span> Denied
</span><span>        LavaMoat</span><span class="token" style="color:#569cd6">->></span><span>App</span><span class="token" style="color:#d4d4d4">:</span><span> Throw error or restrict
</span><span>    </span><span class="token" style="color:#569cd6">end</span><span>
</span><span>    App</span><span class="token" style="color:#569cd6">-->></span><span>User</span><span class="token" style="color:#d4d4d4">:</span><span> Secure output</span></code></div></details></pre><h2 id="browser-bundling-with-lavamoat-plugins">Browser Bundling with LavaMoat Plugins</h2><p>For browser applications, integrate LavaMoat with bundlers like Browserify or Webpack.</p><h3 id="browserify-example">Browserify Example</h3><p>Install:</p><pre><h3 class="Article__CondingLang">bash:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-bash" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#dcdcaa">npm</span><span> </span><span class="token" style="color:#dcdcaa">install</span><span> --save-dev lavamoat-browserify</span></code></div></pre><p>Usage in build script:</p><pre><h3 class="Article__CondingLang">javascript:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-javascript" style='white-space:pre;color:#9cdcfe;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#569cd6">const</span><span> browserify </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#dcdcaa">require</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">'browserify'</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span><span></span><span class="token" style="color:#569cd6">const</span><span> lavamoat </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#dcdcaa">require</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">'lavamoat-browserify'</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span></span><span class="token" style="color:#dcdcaa">browserify</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">'./entry.js'</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token literal-property" style="color:#9cdcfe">plugin</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span>lavamoat</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span> </span><span class="token literal-property" style="color:#9cdcfe">policy</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#dcdcaa">require</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">'./lavamoat/policy.json'</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span class="token method property-access" style="color:#dcdcaa">bundle</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span></code></div></pre><p>For Webpack, use <code>@lavamoat/webpack</code>:</p><pre><h3 class="Article__CondingLang">bash:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-bash" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#dcdcaa">npm</span><span> </span><span class="token" style="color:#dcdcaa">install</span><span> --save-dev @lavamoat/webpack</span></code></div></pre><p>Add to webpack.config.js:</p><pre><h3 class="Article__CondingLang">javascript:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-javascript" style='white-space:pre;color:#9cdcfe;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#569cd6">const</span><span> </span><span class="token" style="color:#4ec9b0">LavaMoatPlugin</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#dcdcaa">require</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">'@lavamoat/webpack'</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">;</span><span>
</span>
<span>module</span><span class="token" style="color:#d4d4d4">.</span><span class="token property-access">exports</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token literal-property" style="color:#9cdcfe">plugins</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span>
</span><span>    </span><span class="token" style="color:#569cd6">new</span><span> </span><span class="token" style="color:#4ec9b0">LavaMoatPlugin</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token literal-property" style="color:#9cdcfe">generatePolicy</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#569cd6">true</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">;</span></code></div></pre><h2 id="policy-files-and-configuration">Policy Files and Configuration</h2><p>LavaMoat policies define package permissions. Generated via <code>--autopolicy</code>, the file structure includes globals, builtins, and packages.</p><h3 id="example-policy-json-snippet">Example policy.json Snippet</h3><pre><h3 class="Article__CondingLang">json:</h3><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-json" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>  </span><span class="token" style="color:#9cdcfe">"resources"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>    </span><span class="token" style="color:#9cdcfe">"keccak"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#9cdcfe">"globals"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        </span><span class="token" style="color:#9cdcfe">"Buffer"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#569cd6">true</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>      </span><span class="token" style="color:#9cdcfe">"packages"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        </span><span class="token" style="color:#9cdcfe">"bn.js"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#569cd6">true</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>    </span><span class="token" style="color:#9cdcfe">"textarea-caret"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>      </span><span class="token" style="color:#9cdcfe">"globals"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        </span><span class="token" style="color:#9cdcfe">"document"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#ce9178">"read"</span><span class="token" style="color:#d4d4d4">,</span><span>
</span><span>        </span><span class="token" style="color:#9cdcfe">"getComputedStyle"</span><span class="token" style="color:#d4d4d4">:</span><span> </span><span class="token" style="color:#569cd6">true</span><span>
</span><span>      </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>  </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span></span><span class="token" style="color:#d4d4d4">}</span></code></div></pre><p>Override defaults in <code>policy-override.json</code> to grant or restrict access. For instance, deny network access for a suspicious package.</p><p>Structure of a LavaMoat policy:</p><p><img alt="ClassDiagram diagram" src="/api/articles/light/LavaMoat-against-JS-supply-chain-attacks-2.svg"></p><pre><details><summary>Show Mermaid Code</summary><div style='color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e'><code class="language-mermaid" style='white-space:pre;color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;tab-size:4;hyphens:none'><span class="token" style="color:#569cd6">classDiagram</span><span>
</span><span>    Policy </span><span class="token" style="color:#569cd6">--></span><span> Resources
</span><span>    Resources </span><span class="token" style="color:#569cd6">--></span><span> Package </span><span class="token" style="color:#d4d4d4">:</span><span> contains multiple
</span><span>    Package </span><span class="token" style="color:#569cd6">--></span><span> Globals
</span><span>    Package </span><span class="token" style="color:#569cd6">--></span><span> Builtins
</span><span>    Package </span><span class="token" style="color:#569cd6">--></span><span> Packages </span><span class="token" style="color:#d4d4d4">:</span><span> dependencies
</span><span>    </span><span class="token" style="color:#569cd6">class</span><span> Policy </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        +resources</span><span class="token" style="color:#d4d4d4">:</span><span> Object
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>    </span><span class="token" style="color:#569cd6">class</span><span> Resources </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        +</span><span class="token text" style="color:#ce9178">[packageName]</span><span class="token" style="color:#d4d4d4">:</span><span> Package
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>    </span><span class="token" style="color:#569cd6">class</span><span> Package </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        +globals</span><span class="token" style="color:#d4d4d4">:</span><span> Object
</span><span>        +builtins</span><span class="token" style="color:#d4d4d4">:</span><span> Object
</span><span>        +packages</span><span class="token" style="color:#d4d4d4">:</span><span> Object
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>    </span><span class="token" style="color:#569cd6">class</span><span> Globals </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        +</span><span class="token text" style="color:#ce9178">[globalName]</span><span class="token" style="color:#d4d4d4">:</span><span> boolean or string
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>    </span><span class="token" style="color:#569cd6">class</span><span> Builtins </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        +</span><span class="token text" style="color:#ce9178">[builtinName]</span><span class="token" style="color:#d4d4d4">:</span><span> boolean
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span><span>
</span><span>    </span><span class="token" style="color:#569cd6">class</span><span> Packages </span><span class="token" style="color:#d4d4d4">{</span><span>
</span><span>        +</span><span class="token text" style="color:#ce9178">[depName]</span><span class="token" style="color:#d4d4d4">:</span><span> boolean
</span><span>    </span><span class="token" style="color:#d4d4d4">}</span></code></div></details></pre><h2 id="benefits-and-use-cases">Benefits and Use Cases</h2><ul><li><strong>Mitigates Common Attacks</strong>: Protects against lifecycle script exploits, prototype pollution, and unauthorized API calls.</li><li><strong>Production-Proven</strong>: Used in MetaMask with up to 30 million users.</li><li><strong>Easy Integration</strong>: Minimal overhead for existing projects.</li><li><strong>Use Cases</strong>: Blockchain wallets, web applications, Node.js servers where third-party dependencies are prevalent.</li></ul><h2 id="conclusion">Conclusion</h2><p>LavaMoat empowers developers to fortify their JavaScript applications against evolving supply chain threats. By implementing its tools for installation, build, and runtime, you can significantly reduce risks without overhauling your codebase. Start with <code>@lavamoat/allow-scripts</code> for quick wins and expand to full compartmentalization. For more details, visit the <a href="https://github.com/LavaMoat/LavaMoat" target="_blank" rel="noreferrer">LavaMoat GitHub repository<svg fill="none" height="12" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="12" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round" style="margin-left:2px"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg></a>.</p><h2 id="resources-and-links">Resources and Links</h2><ul><li><a href="https://lavamoat.github.io" target="_blank" rel="noreferrer">LavaMoat Docs<svg fill="none" height="12" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="12" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round" style="margin-left:2px"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg></a></li><li><a href="https://github.com/LavaMoat/LavaMoat" target="_blank" rel="noreferrer">GitHub Repo – LavaMoat<svg fill="none" height="12" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="12" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round" style="margin-left:2px"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg></a></li><li><a href="https://github.com/LavaMoat" target="_blank" rel="noreferrer">Github Organisation - LavaMoat<svg fill="none" height="12" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="12" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round" style="margin-left:2px"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg></a></li></ul></div></div></div></div><footer class="Footer">The API for this site <a href="https://github.com/shapkarin/shapkarin.me/tree/master/src/Generate-Backend" target="_blank" rel="noreferrer">is generated<svg fill="none" height="12" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="12" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round" style="margin-left:2px"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg></a>and stored as <a href="https://github.com/shapkarin/shapkarin.me/tree/gh-pages/api" target="_blank" rel="noreferrer">JSON and Markdown<svg fill="none" height="12" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="12" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round" style="margin-left:2px"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg></a>on GitHub Pages.<br>It <a href="https://github.com/shapkarin/shapkarin.me/blob/main/.github/workflows/build-deploy.yml" target="_blank" rel="noreferrer">uses Github Actions<svg fill="none" height="12" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="12" xmlns="http://www.w3.org/2000/svg" stroke-linecap="round" stroke-linejoin="round" style="margin-left:2px"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg></a>to help with CI and generates a static version.</footer></div><canvas height="850" id="background" width="480"></canvas></body></html>